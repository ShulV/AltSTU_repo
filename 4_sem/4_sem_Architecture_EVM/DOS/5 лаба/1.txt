		; программа вычисляет Y:= F(X,Y) + F(Y,X) - F(2,3)
			; Векторы программных прерываний
.db 70			;
.db 80			;
.org 08 		;
			; Векторы аппаратных прерываний
.db 0b0			;
			
.org 10 		;

int 0 			; Программное прерывание на ввод
		; ПОСЧЁТ Y
call FUNC		; вызов функции и подсчёт F(X,Y)
push a			; положить F(X,Y) в стек из rA
load a,Y		; скопировать содержимое о адресу Y в rA
load b,X		; скопировать содержимое о адресу X в rB 
call FUNC		; вызов функции и подсчёт F(Y,X)
pop b			; вытянуть F(X,Y) из стека в rB
OLDP: adr a,b		; сложение F(Y,X)+F(X,Y) (rA + rB, рез. в rA)
push a			; положить F(Y,X)+F(X,Y) в стек из rA
mvi a,2			; непосредственная загрузка 2 в rA
mvi b,3			; непосредственная загрузка 3 в rB 
call FUNC		; вызов функции и подсчёт F(Y,X)
pop b			; вытянуть F(Y,X)+F(X,Y) из стека в rB
xchg			; обмен регистров (rA и rB обмениваются содержимым)
OLDM: sbr a,b		; [F(Y,X)+F(X,Y)] - F(2,3), рез. в rA
int 1 			; Программное прерывание на вывод

stop			; останов
X: .ds 1		; резервир. 1 байта под массив X
Y: .ds 1		; резервир. 1 байта под массив Y

		; подпрограмма вычисления F(A,B)= (B*B-1) + (A+B)*(A+B)
		; вход: (rA) - A; (rB) - B
		; выход: (rA) - (B*B-1) + (A+B)*(A+B)
FUNC: push b		; положить B из rB в стек 
adr a,b			; сложение регистров (rA + rB, рез. в rA)
xchg			; обмен rA и rB содержимым (A+B в rB)
mur a,b			; умножение (A+B)^2 ((A+B) в R+1 т.е. в rB
			; умножается на (A+B) в rB) рез. - в паре рег.
pop a			; вытянуть B из стека в rA
push b			; положить (A+B)^2 в стек
xchg			; обмен rA и rB содержимым (A+B в rB)
mur a,b			; умножение B*B (B в R+1 т.е. в rB
			; умножается на B в rB) рез. - в паре рег.
sbi b,1			; B*B-1 (непосред. вычит. rB-1) рез. в rB
pop a			; вытянуть (A+B)^2 из стека
adr a,b			; [B*B-1]+[(A+B)^2] (rA+rB, рез. в rA)
ret			; возврат в вызывающую программу

			; Программное прерывание на ввод
		; ЗАПИСЬ X,Y
.org 70			; устан. Знач. счетчика адр. команд равным абс. адресу 70
di 			; Запретить прерывания
in 0			; ввод X (содерж. порта 0 заносится в rA)
mov b,a			; пересылка регистров (содержимое rA копир. в rB)
in 1			; ввод Y (содерж. порта 1 заносится в rA)
xchg			; обмен регистров (rA и rB обмениваются содержимым)
stor a,X		; запись rA в X (содерж. rA копир. по абс. адр. X)
stor b,Y		; запись rB в Y (содерж. rB копир. по абс. адр. Y)
ei 			; Разрешить прерывания
rin 			; Возврат из прерывания

			; Программное прерывание на вывод
.org 80 		; устан. Знач. счетчика адр. команд равным абс. адресу 80
di 			; Запретить прерывания
out 2			; вывести в канал 2
ei 			; Разрешить прерывания
rin 			; Возврат из прерывания


			; апп. прерывание №1
			; изменение знаков “-” на “+”  и “+” на “-” в алгоритме подпрограммы
			; и рестарт программы с очисткой стека и рабочих переменных
.org 0b0		;
di 			; Запретить прерывания


ei 			; Разрешить прерывания
rin 			; Выход из прерывания
